import{a as ne,b as re,c as se,d as oe,e as ae,h as le,i as ce,j as me,k as de}from"./chunk-VUYJUVQ5.js";import{a as pe}from"./chunk-E2YZKR4W.js";import{m as M,n as w}from"./chunk-UZNDUMES.js";import{i as J}from"./chunk-AGSWOYKP.js";import{c as K,e as X,j as Y,q as Z,r as ee,t as te,u as ie}from"./chunk-JCKB2E4I.js";import"./chunk-N6Q423HR.js";import{e as z,g as j,j as G,w as H}from"./chunk-4WYIZYTR.js";import{$b as q,Ab as f,Eb as g,Jb as b,Kb as a,Pb as N,Qb as A,Rb as B,Sb as P,Tb as l,Ub as y,Vb as V,Xb as L,Yb as F,Za as c,Zb as k,_a as D,_b as W,dc as Q,fc as U,gc as I,hc as O,ic as R,la as v,nb as h,oa as $,pb as p,ub as E,vb as T,wb as C,xb as S,ya as u,yb as s,za as _,zb as o}from"./chunk-N6N27DRQ.js";var ue=(n,m)=>m.id,_e=(n,m,e)=>({id:"users-pagination",itemsPerPage:n,currentPage:m,totalItems:e});function ge(n,m){if(n&1&&(s(0,"option",15),l(1),o()),n&2){let e=m.$implicit;p("value",e),c(),V(" ",e," ")}}function fe(n,m){if(n&1&&(s(0,"span"),l(1),o()),n&2){let e=a().$implicit;c(),y(e.first_name)}}function be(n,m){if(n&1){let e=g();s(0,"input",42),k("ngModelChange",function(t){u(e);let i=a().$implicit;return F(i.first_name,t)||(i.first_name=t),_(t)}),o()}if(n&2){let e=a().$implicit;L("ngModel",e.first_name),p("readonly",!e.isEditing)}}function he(n,m){if(n&1&&(s(0,"span"),l(1),o()),n&2){let e=a().$implicit;c(),y(e.last_name)}}function xe(n,m){if(n&1){let e=g();s(0,"input",42),k("ngModelChange",function(t){u(e);let i=a().$implicit;return F(i.last_name,t)||(i.last_name=t),_(t)}),o()}if(n&2){let e=a().$implicit;L("ngModel",e.last_name),p("readonly",!e.isEditing)}}function ve(n,m){if(n&1){let e=g();s(0,"li",35),l(1),s(2,"button",43),b("click",function(){let t=u(e).$implicit,i=a().$implicit,d=a();return d.selectedUser=i,_(d.removeRole(t))}),f(3,"i",44),o()()}if(n&2){let e=m.$implicit;c(),V(" ",e," ")}}function Ce(n,m){if(n&1){let e=g();s(0,"span",45),l(1,"Active"),o(),f(2,"br"),s(3,"button",46),b("click",function(){u(e);let t=a().$implicit,i=a();return _(i.banUser(t))}),f(4,"i",47),l(5," Ban User "),o()}}function Se(n,m){if(n&1){let e=g();s(0,"span",48),l(1,"Banned"),o(),f(2,"br"),s(3,"button",49),b("click",function(){u(e);let t=a().$implicit,i=a();return _(i.unBanUser(t))}),f(4,"i",50),l(5," Unlock User "),o()}}function ye(n,m){if(n&1){let e=g();s(0,"button",51),b("click",function(){u(e);let t=a().$implicit,i=a();return _(i.toggleEdit(t))}),f(1,"i",52),o()}}function Ue(n,m){if(n&1){let e=g();s(0,"button",53),b("click",function(){u(e);let t=a().$implicit,i=a();return _(i.saveUser(t))}),f(1,"i",54),o()}}function we(n,m){if(n&1){let e=g();s(0,"tr")(1,"td"),h(2,fe,2,1,"span",32)(3,be,1,2,"input",33),o(),s(4,"td"),h(5,he,2,1,"span",32)(6,xe,1,2,"input",33),o(),s(7,"td"),l(8),o(),s(9,"td")(10,"ul",34),C(11,ve,4,1,"li",35,T),o(),s(13,"button",36),b("click",function(){let t=u(e).$implicit,i=a();return _(i.selectedUser=t)}),f(14,"i",37),l(15," Add Role "),o()(),s(16,"td"),h(17,Ce,6,0)(18,Se,6,0),o(),s(19,"td",38)(20,"div",39),h(21,ye,2,0,"button",40)(22,Ue,2,0,"button",41),o()()()}if(n&2){let e=m.$implicit;a();let r=P(55);c(2),p("ngIf",!e.isEditing),c(),p("ngIf",e.isEditing),c(2),p("ngIf",!e.isEditing),c(),p("ngIf",e.isEditing),c(2),y(e.username),c(3),S(e.roles),c(2),p("ngbPopover",r)("popoverTitle","Add Role")("autoClose","outside"),c(4),E(17,e.status===null?17:-1),c(),E(18,e.status==="banned"?18:-1),c(3),p("ngIf",!e.isEditing),c(),p("ngIf",e.isEditing)}}function Ee(n,m){if(n&1){let e=g();s(0,"app-dynamic-form",55),U(1,"async"),b("submitEvent",function(t){u(e);let i=a();return _(i.handleFormSubmit(t))}),o()}if(n&2){let e=a();p("questions",I(1,3,e.questions$))("btnText","Filter")("perPage",4)}}function Te(n,m){if(n&1){let e=g();s(0,"div",56)(1,"app-dynamic-form",57),U(2,"async"),b("submitEvent",function(t){u(e);let i=a();return _(i.submitRole(t))}),o()()}if(n&2){let e=a();c(),p("questions",I(2,2,e.roleQuestions$))("btnText","Add")}}var Ge=(()=>{class n{constructor(e){this.userService=v(pe),this.toastService=v(J),this.modalService=v(ne),this.confirmService=v(de),this.users=[],this.page=1,this.perPage=10,this.total=0,this.pageSizes=[10,20,30,40,50],this.isLoading=!1,this.filters={},this.selectedUser={},this.questions$=e.getUserFiltersQuestions(),this.roleQuestions$=e.getUserAddRoleQuestions()}ngOnInit(){this.getUsersWithRoles()}getUsersWithRoles(){this.userService.getUserWithRoles(this.page,this.perPage,this.filters).subscribe({next:e=>{this.users=e.data.users,this.total=e.data.total,console.log(this.users)}})}handlePageChange(e){this.page=e,this.getUsersWithRoles()}handlePageSizeChange(e){this.perPage=e.target.value,this.page=1,this.getUsersWithRoles()}handleFormSubmit(e){let r={email:e.formData.emailAddress,first_name:e.formData.firstName,last_name:e.formData.lastName,gender:e.formData.gender};this.filters=r,console.log(this.filters),this.page=1,this.getUsersWithRoles()}banUser(e){this.userService.banUser(e.id).subscribe({next:r=>{console.log(r),e.status="banned",this.toastService.success(e.first_name+" is banned from accessing the system","Ban Status")}})}unBanUser(e){this.userService.unBanUser(e.id).subscribe({next:r=>{console.log(r),e.status=null,this.toastService.success(e.first_name+" can now access the system","Ban Status")}})}submitRole(e){let r=e.formData.role;if(console.log(e.formData),this.selectedUser.roles.includes(r))this.toastService.warning(r+" role is already assigned to "+this.selectedUser.first_name,"Already Assigned");else{let t={role:r};this.userService.updateUserRoles("addrole",t,this.selectedUser.id).subscribe({next:i=>{console.log(i);let d=this.users.findIndex(x=>x.id===this.selectedUser.id);d!==-1&&(this.users[d].roles.push(r),this.toastService.success("Role is added successfully"))},error:i=>{this.toastService.error("Some error occured")}})}}removeRole(e){if(!this.selectedUser.roles.includes(e))this.toastService.warning(e+" role is not assigned to "+this.selectedUser.first_name,"Not Assigned");else{let r={role:e};this.userService.updateUserRoles("removerole",r,this.selectedUser.id).subscribe({next:t=>{console.log(t);let i=this.users.findIndex(d=>d.id===this.selectedUser.id);if(i!==-1){let d=this.users[i].roles.indexOf(e);d!==-1&&(this.users[i].roles.splice(d,1),this.toastService.success("Role is removed successfully"))}},error:t=>{this.toastService.error("Some error occured")}})}}toggleEdit(e){e.isEditing=!e.isEditing}saveUser(e){e.isEditing=!1,console.log(e);let r={first_name:e.first_name,last_name:e.last_name};this.userService.updateUser(e.id,r).subscribe({next:t=>{Object.assign(e,t);let i=this.users.findIndex(d=>d.id===e.id);i!==-1&&(this.users[i]=e),this.toastService.success("Updated successfully")},error:t=>{console.log(t)}})}deleteUser(e){this.confirmService.confirm("Confirm Deletion",`Are you sure you want to delete ${e.type}?`).then(r=>{r&&this.userService.deleteUser(e.id).subscribe({next:t=>{console.log("Delete successful",t),this.toastService.success("Delete successful"),this.users=this.users.filter(i=>i.id!==e.id)},error:t=>{console.error("Error deleting user",t),this.toastService.success("Error deleting user")}})})}resetPassword(e,r){this.selectedUser=r,this.modalService.open(e,{centered:!0})}changePassword(e){let r=e.formData.password,t=e.formData.confirmPassword;if(console.log(e.formData),r===t){let i={password:r};this.userService.changePassword(i,this.selectedUser.id).subscribe({next:d=>{console.log(d),this.toastService.success("Password is changed successfully"),this.modalService.dismissAll()},error:d=>{this.toastService.error("Some error occured")}})}else this.toastService.error("Passwords do not match")}static{this.\u0275fac=function(r){return new(r||n)(D(w))}}static{this.\u0275cmp=$({type:n,selectors:[["app-user-list"]],viewQuery:function(r,t){if(r&1&&N(M,5),r&2){let i;A(i=B())&&(t.dynamicFormComponent=i.first)}},standalone:!0,features:[W([w]),q],decls:56,vars:11,consts:[["popContent",""],["addRole",""],[1,"container","min-vh-100","py-4"],[1,"card"],[1,"card-header","d-flex","align-items-center"],["aria-label","breadcrumb",1,"w-100"],[1,"breadcrumb","my-auto"],[1,"breadcrumb-item"],["href","#"],[1,"breadcrumb-item","active"],["aria-current","page",1,"breadcrumb-item","active"],[1,"card-body"],[1,"row","mb-3"],[1,"col-md-3","my-auto"],[1,"p-1",3,"change"],[3,"value"],[1,"col-md-9","text-end"],["role","group","aria-label","Basic example",1,"btn-group"],["type","button",1,"btn","btn-light",3,"ngbPopover","popoverTitle","autoClose"],[1,"bi","bi-filter","me-2"],["routerLink","/users/create",1,"btn","btn-light"],[1,"bi","bi-person-add","me-2"],[1,"row"],[1,"col-lg-12"],[1,"table-responsive"],[1,"table"],[1,"bg-primary"],["scope","col"],["scope","col",1,"text-end"],[1,"row","my-3"],[1,"col-lg-10","text-center","mx-auto"],["id","users-pagination","previousLabel","Prev","nextLabel","Next",1,"bg-success",3,"pageChange","responsive"],[4,"ngIf"],["type","text","class","form-control","required","true",3,"ngModel","readonly","ngModelChange",4,"ngIf"],[1,"list-group","list-group-flush","list-group-numbered"],[1,"list-group-item","d-flex","justify-content-between","align-items-start"],[1,"btn","btn-success","btn-sm",3,"click","ngbPopover","popoverTitle","autoClose"],[1,"bi","bi-person-fill-up","me-2"],[1,"text-end"],["role","group","aria-label","Edit and Delete Button Group",1,"btn-group"],["type","button","class","btn btn-primary",3,"click",4,"ngIf"],["type","button","class","btn btn-success",3,"click",4,"ngIf"],["type","text","required","true",1,"form-control",3,"ngModelChange","ngModel","readonly"],["placement","top","ngbTooltip","Remove Role",1,"btn","btn-warning","btn-sm",3,"click"],[1,"bi","bi-person-dash"],[1,"badge","bg-success"],[1,"btn","btn-danger","btn-sm","m-1",3,"click"],[1,"bi","bi-person-lock","me-2"],[1,"badge","bg-danger"],[1,"btn","btn-info","btn-sm","m-1",3,"click"],[1,"bi","bi-person-check","me-2"],["type","button",1,"btn","btn-primary",3,"click"],[1,"bi","bi-pencil-square"],["type","button",1,"btn","btn-success",3,"click"],[1,"bi","bi-check-lg"],[3,"submitEvent","questions","btnText","perPage"],[1,"min-250"],[3,"submitEvent","questions","btnText"]],template:function(r,t){if(r&1){let i=g();s(0,"div",2)(1,"div",3)(2,"div",4)(3,"nav",5)(4,"ol",6)(5,"li",7)(6,"a",8),l(7,"Home"),o()(),s(8,"li",9),l(9,"Administration"),o(),s(10,"li",10),l(11,"Users"),o()()()(),s(12,"div",11)(13,"div",12)(14,"div",13),l(15," Per Page: "),s(16,"select",14),b("change",function(x){return u(i),_(t.handlePageSizeChange(x))}),C(17,ge,2,2,"option",15,T),o()(),s(19,"div",16)(20,"div",17)(21,"button",18),f(22,"i",19),l(23,"Filter "),o(),s(24,"a",20),f(25,"i",21),l(26,"Add "),o()()()(),s(27,"div",22)(28,"div",23)(29,"div",24)(30,"table",25)(31,"thead")(32,"tr",26)(33,"th",27),l(34,"First Name"),o(),s(35,"th",27),l(36,"Last Name"),o(),s(37,"th",27),l(38,"Email"),o(),s(39,"th",27),l(40,"Roles"),o(),s(41,"th",27),l(42,"Status"),o(),s(43,"th",28),l(44,"Action"),o()()(),s(45,"tbody"),C(46,we,23,12,"tr",null,ue),U(48,"paginate"),o()()()()(),s(49,"div",29)(50,"div",30)(51,"pagination-controls",31),b("pageChange",function(x){return u(i),_(t.handlePageChange(x))}),o()()()()()(),h(52,Ee,2,5,"ng-template",null,0,R)(54,Te,3,4,"ng-template",null,1,R)}if(r&2){let i=P(53);c(17),S(t.pageSizes),c(4),p("ngbPopover",i)("popoverTitle","Filter Users")("autoClose","outside"),c(25),S(O(48,4,t.users,Q(7,_e,t.perPage,t.page,t.total))),c(5),p("responsive",!0)}},dependencies:[me,le,ce,ie,Z,ee,K,X,te,Y,j,M,se,re,ae,oe,H,G,z],styles:[".user-avatar[_ngcontent-%COMP%]{height:40px;width:40px}.min-250[_ngcontent-%COMP%]{min-width:250px}"]})}}return n})();export{Ge as UserListComponent};
