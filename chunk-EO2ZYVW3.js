import{a as U}from"./chunk-TU2ZNCML.js";import{c as v}from"./chunk-63TX3NUI.js";import{c as S,d as E}from"./chunk-ZOPMU54Y.js";import{d as T}from"./chunk-KALLYKT4.js";import{C as g,fa as l,ga as w,ia as k,ka as a,la as u,pa as I,t as h,x as c,z as f}from"./chunk-MLHGNWXV.js";var m=new k("JWT_OPTIONS"),p=(()=>{class o{constructor(e=null){this.tokenGetter=e&&e.tokenGetter||function(){}}urlBase64Decode(e){let t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:{t+="==";break}case 3:{t+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(t)}b64decode(e){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r="";if(e=String(e).replace(/=+$/,""),e.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let i=0,s,n,D=0;n=e.charAt(D++);~n&&(s=i%4?s*64+n:n,i++%4)?r+=String.fromCharCode(255&s>>(-2*i&6)):0)n=t.indexOf(n);return r}b64DecodeUnicode(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._decodeToken(t)):this._decodeToken(e)}_decodeToken(e){if(!e||e==="")return null;let t=e.split(".");if(t.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let r=this.urlBase64Decode(t[1]);if(!r)throw new Error("Cannot decode the token.");return JSON.parse(r)}getTokenExpirationDate(e=this.tokenGetter()){return e instanceof Promise?e.then(t=>this._getTokenExpirationDate(t)):this._getTokenExpirationDate(e)}_getTokenExpirationDate(e){let t;if(t=this.decodeToken(e),!t||!t.hasOwnProperty("exp"))return null;let r=new Date(0);return r.setUTCSeconds(t.exp),r}isTokenExpired(e=this.tokenGetter(),t){return e instanceof Promise?e.then(r=>this._isTokenExpired(r,t)):this._isTokenExpired(e,t)}_isTokenExpired(e,t){if(!e||e==="")return!0;let r=this.getTokenExpirationDate(e);return t=t||0,r===null?!1:!(r.valueOf()>new Date().valueOf()+t*1e3)}getAuthScheme(e,t){return typeof e=="function"?e(t):e}}return o.\u0275fac=function(e){return new(e||o)(a(m))},o.\u0275prov=l({token:o,factory:o.\u0275fac}),o})(),y=o=>o instanceof Promise?g(()=>o):h(o),x=(()=>{class o{constructor(e,t,r){this.jwtHelper=t,this.document=r,this.standardPorts=["80","443"],this.tokenGetter=e.tokenGetter,this.headerName=e.headerName||"Authorization",this.authScheme=e.authScheme||e.authScheme===""?e.authScheme:"Bearer ",this.allowedDomains=e.allowedDomains||[],this.disallowedRoutes=e.disallowedRoutes||[],this.throwNoTokenError=e.throwNoTokenError||!1,this.skipWhenExpired=e.skipWhenExpired}isAllowedDomain(e){let t=new URL(e.url,this.document.location.origin);if(t.host===this.document.location.host)return!0;let r=`${t.hostname}${t.port&&!this.standardPorts.includes(t.port)?":"+t.port:""}`;return this.allowedDomains.findIndex(i=>typeof i=="string"?i===r:i instanceof RegExp?i.test(r):!1)>-1}isDisallowedRoute(e){let t=new URL(e.url,this.document.location.origin);return this.disallowedRoutes.findIndex(r=>{if(typeof r=="string"){let i=new URL(r,this.document.location.origin);return i.hostname===t.hostname&&i.pathname===t.pathname}return r instanceof RegExp?r.test(e.url):!1})>-1}handleInterception(e,t,r){let i=this.jwtHelper.getAuthScheme(this.authScheme,t);if(!e&&this.throwNoTokenError)throw new Error("Could not get token from tokenGetter function.");let s=h(!1);return this.skipWhenExpired&&(s=e?y(this.jwtHelper.isTokenExpired(e)):h(!0)),e?s.pipe(c(n=>n&&this.skipWhenExpired?t.clone():t.clone({setHeaders:{[this.headerName]:`${i}${e}`}})),f(n=>r.handle(n))):r.handle(t)}intercept(e,t){if(!this.isAllowedDomain(e)||this.isDisallowedRoute(e))return t.handle(e);let r=this.tokenGetter(e);return y(r).pipe(f(i=>this.handleInterception(i,e,t)))}}return o.\u0275fac=function(e){return new(e||o)(a(m),a(p),a(T))},o.\u0275prov=l({token:o,factory:o.\u0275fac}),o})(),_=(()=>{class o{constructor(e){if(e)throw new Error("JwtModule is already loaded. It should only be imported in your application's main module.")}static forRoot(e){return{ngModule:o,providers:[{provide:E,useClass:x,multi:!0},e.jwtOptionsProvider||{provide:m,useValue:e.config},p]}}}return o.\u0275fac=function(e){return new(e||o)(a(o,12))},o.\u0275mod=I({type:o}),o.\u0275inj=w({}),o})();var K=(()=>{class o{constructor(){this.apiUrl=U.apiUrl,this.isAuthenticated=!1,this.userRoles=["admin"],this.userFilters=[],this.userId=0,this.http=u(S),this.router=u(v),this.jwtHelper=u(p)}register(e){return this.http.post(this.apiUrl+"register",e)}login(e){return this.http.post(this.apiUrl+"signin",e).pipe(c(t=>{let r=t.data;r.token&&(this.isAuthenticated=!0,localStorage.setItem("authToken",r.token),localStorage.setItem("roles",JSON.stringify(r.roles)),localStorage.setItem("user",JSON.stringify(r.user)),window.location.reload())}))}requestResetPassword(e){return this.http.post(this.apiUrl+"request-reset-password",e)}resetPassword(e){return this.http.post(this.apiUrl+"reset-password",e)}logout(){this.isAuthenticated=!1,localStorage.removeItem("authToken"),localStorage.removeItem("roles"),localStorage.removeItem("user"),window.location.reload()}getToken(){return this.isAuthenticatedUser()?localStorage.getItem("authToken"):""}isAuthenticatedUser(){let e=localStorage.getItem("authToken");return this.isAuthenticated=!this.jwtHelper.isTokenExpired(e),this.isAuthenticated}getUserRoles(){return localStorage.getItem("roles")&&(this.userRoles=JSON.parse(localStorage.getItem("roles")??"")),this.userRoles}getUserId(){let e=localStorage.getItem("authToken");return this.decodedToken=this.jwtHelper.decodeToken(e),this.userId=this.decodedToken?.sub,console.log(this.userId),+this.userId||0}getUser(){let e=this.getUserId();return this.http.get(this.apiUrl+"profile/"+e)}getCurrentUser(){return JSON.parse(localStorage.getItem("user")??"")}roleMatch(e){let t=!1,r=this.getUserRoles();return e.forEach(i=>{if(r?.includes(i)){t=!0;return}}),t&&this.isAuthenticatedUser()}getCompanyId(){let e=null;return localStorage.getItem("user")&&(e=JSON.parse(localStorage.getItem("user")??"")),e?.company_id??null}static{this.\u0275fac=function(t){return new(t||o)}}static{this.\u0275prov=l({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{_ as a,K as b};
